{{- if .Values.secret.enabled -}}
{{- $secretName := print (include "elasticsearch.uname" .) "-credentials" | quote  -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ template "elasticsearch.uname" . }}-credentials
  labels:
    heritage: {{ .Release.Service | quote }}
    release: {{ .Release.Name | quote }}
    chart: "{{ .Chart.Name }}"
    app: "{{ template "elasticsearch.uname" . }}"
    {{- range $key, $value := .Values.labels }}
    {{ $key }}: {{ $value | quote }}
    {{- end }}
type: Opaque
data:
  username: {{ "elastic" | b64enc }}
  {{- if .Values.secret.password }}
  password: {{ .Values.secret.password | b64enc }}
  {{- else }}
  {{- $secretObj := (lookup "v1" "Secret" .Release.Namespace $secretName) | default dict }}
  {{- $secretData := (get $secretObj "data") | default dict }}
  {{- $passwordValue := (get $secretData "password") | default (randAlphaNum 16 | b64enc) }}
  password: {{ $passwordValue }}
  {{- end }}
{{- end }}
